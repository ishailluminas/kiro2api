<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Dashboard - Kiro2API</title>
    <!-- 引入中文字体优化 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; }
    </style>
</head>
<body>
    <!-- 动态氛围背景 -->
    <div class="ambient-light">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="orb orb-4"></div>
    </div>

    <div class="container">
        <!-- 头部区域 -->
        <header class="header">
            <h1>KIRO 控制台</h1>
            <p>高性能 AI API 代理与 Token 智能管理系统</p>
        </header>

        <!-- 悬浮导航 -->
        <nav class="nav-capsule">
            <button class="nav-btn active" data-tab="tokens">Token 监控</button>
            <button class="nav-btn" data-tab="auth-config">认证配置</button>
        </nav>

        <!-- Token 监控面板 -->
        <main id="tokens-tab" class="tab-content active fade-enter">
            <!-- 数据概览 -->
            <div class="dashboard-grid">
                <div class="glass-card stat-card">
                    <span class="stat-label">Token 总数</span>
                    <span class="stat-value" id="totalTokens">-</span>
                </div>
                <div class="glass-card stat-card">
                    <span class="stat-label">活跃 Token</span>
                    <span class="stat-value" id="activeTokens">-</span>
                </div>
                <div class="glass-card stat-card">
                    <span class="stat-label">最后更新</span>
                    <span class="stat-value" id="lastUpdate" style="font-size: 1.5rem;">-</span>
                </div>
            </div>

            <!-- 操作栏 -->
            <div class="toolbar">
                <div style="display: flex; gap: 16px; align-items: center;">
                    <button class="btn btn-primary" id="refreshTokensBtn">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                        立即刷新
                    </button>
                    <div class="toggle-switch" id="autoRefreshSwitch">
                        <div class="toggle-track">
                            <div class="toggle-knob"></div>
                        </div>
                        <span style="font-size: 0.9rem; font-weight: 500;">自动刷新</span>
                    </div>
                </div>
            </div>

            <!-- 数据表格 -->
            <div class="glass-card table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>用户邮箱</th>
                            <th>Token 指纹</th>
                            <th>认证方式</th>
                            <th>剩余额度</th>
                            <th>过期时间</th>
                            <th>最后使用</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody id="tokenTableBody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px;">
                                <div class="spinner" style="margin: 0 auto 16px;"></div>
                                <span style="color: var(--text-muted);">正在加载数据...</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>

        <!-- 认证配置面板 -->
        <main id="auth-config-tab" class="tab-content fade-enter" style="display: none;">
            <!-- 配置概览 -->
            <div class="dashboard-grid">
                <div class="glass-card stat-card">
                    <span class="stat-label">配置文件</span>
                    <span class="stat-value config-path" id="configPath" style="font-size: 1rem;">-</span>
                </div>
                <div class="glass-card stat-card">
                    <span class="stat-label">配置总数</span>
                    <span class="stat-value" id="configCount">-</span>
                </div>
            </div>

            <!-- 操作栏 -->
            <div class="toolbar">
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-primary" id="reloadConfigBtn">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        热加载配置
                    </button>
                    <button class="btn btn-success" id="showAddFormBtn">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                        添加配置
                    </button>
                    <button class="btn btn-glass" id="showImportFormBtn">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        批量导入
                    </button>
                </div>
            </div>

            <!-- 配置列表 -->
            <div class="glass-card table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>序号</th>
                            <th>认证类型</th>
                            <th>Token 指纹</th>
                            <th>Client ID</th>
                            <th>当前状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="authConfigTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                <div class="spinner" style="margin: 0 auto 16px;"></div>
                                <span style="color: var(--text-muted);">正在加载配置...</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- 模态框：添加配置 -->
    <div id="addAuthForm" class="modal-overlay">
        <div class="modal-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 1.5rem; font-weight: 700;">添加新认证</h3>
                <button class="btn btn-glass" id="closeAddFormBtn" style="padding: 8px;">✕</button>
            </div>

            <div class="glass-card" style="padding: 20px; margin-bottom: 24px; background: rgba(255,255,255,0.02);">
                <h4 style="margin-bottom: 16px; color: #a5b4fc;">🚀 智能解析 (粘贴 JSON)</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div>
                        <label class="form-label">Client JSON</label>
                        <textarea id="clientJsonInput" class="input-glass" style="min-height: 80px;" placeholder='包含 clientId 和 clientSecret 的 JSON...'></textarea>
                    </div>
                    <div>
                        <label class="form-label">Token JSON</label>
                        <textarea id="tokenJsonInput" class="input-glass" style="min-height: 80px;" placeholder='包含 refreshToken 的 JSON...'></textarea>
                    </div>
                </div>
                <button class="btn btn-primary" id="parseJsonBtn" style="width: 100%; margin-top: 16px; justify-content: center;">开始智能解析</button>
            </div>

            <div>
                <h4 style="margin-bottom: 16px;">手动配置</h4>
                <div class="form-group">
                    <label class="form-label">认证类型</label>
                    <select id="authTypeSelect" class="input-glass">
                        <option value="Social">Social Login (社交登录)</option>
                        <option value="IdC">Identity Center (IdC)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Refresh Token <span style="color: #ef4444">*</span></label>
                    <textarea id="refreshTokenInput" class="input-glass" rows="2"></textarea>
                </div>
                <div class="idc-fields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Client ID <span style="color: #ef4444">*</span></label>
                        <input type="text" id="clientIdInput" class="input-glass">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Client Secret <span style="color: #ef4444">*</span></label>
                        <textarea id="clientSecretInput" class="input-glass" rows="2"></textarea>
                    </div>
                </div>
            </div>

            <div style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 32px;">
                <button class="btn btn-glass" id="cancelAddBtn">取消</button>
                <button class="btn btn-success" id="submitAddBtn">保存配置</button>
            </div>
        </div>
    </div>

    <!-- 模态框：批量导入 -->
    <div id="importAccountsForm" class="modal-overlay">
        <div class="modal-card" style="max-width: 800px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 1.5rem; font-weight: 700;">批量导入账户</h3>
                <button class="btn btn-glass" id="closeImportFormBtn" style="padding: 8px;">✕</button>
            </div>

            <div style="margin-bottom: 24px;">
                <div class="import-method-tabs" style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <button class="btn btn-glass active" data-method="file" style="flex: 1; justify-content: center;">📂 文件上传</button>
                    <button class="btn btn-glass" data-method="paste" style="flex: 1; justify-content: center;">📋 粘贴文本</button>
                </div>

                <div id="fileUploadMethod">
                    <div class="glass-card" id="fileUploadArea" style="padding: 40px; text-align: center; border-style: dashed; cursor: pointer;">
                        <input type="file" id="accountFileInput" accept=".json" style="display: none;">
                        <div style="font-size: 3rem; margin-bottom: 16px;">📤</div>
                        <p style="color: var(--text-muted);">点击或拖拽 .json 文件到此处</p>
                    </div>
                    <div id="fileInfo" class="glass-card" style="display: none; margin-top: 16px; padding: 12px 20px; align-items: center; justify-content: space-between; background: rgba(16, 185, 129, 0.1);">
                        <span id="fileName" style="color: #34d399;">filename.json</span>
                        <button class="btn btn-danger" id="removeFileBtn" style="padding: 4px 12px; font-size: 0.8rem;">移除</button>
                    </div>
                </div>

                <div id="pasteJsonMethod" style="display: none;">
                    <textarea id="accountJsonInput" class="input-glass" placeholder='请粘贴 JSON 数组...' rows="10"></textarea>
                </div>

                <button class="btn btn-primary" id="parseAccountsBtn" style="width: 100%; margin-top: 20px; justify-content: center;">解析账户数据</button>
            </div>

            <div id="previewSection" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h4 style="color: var(--text-muted);">导入预览</h4>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-glass" id="selectAllBtn" style="padding: 6px 12px; font-size: 0.8rem;">全选</button>
                        <button class="btn btn-glass" id="selectValidBtn" style="padding: 6px 12px; font-size: 0.8rem;">仅有效</button>
                        <button class="btn btn-glass" id="invertSelectBtn" style="padding: 6px 12px; font-size: 0.8rem;">反选</button>
                    </div>
                </div>

                <div class="table-wrapper glass-card" style="max-height: 300px; overflow-y: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" id="selectAllCheckbox"></th>
                                <th>邮箱</th>
                                <th>类型</th>
                                <th>Token</th>
                                <th>过期时间</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody id="previewTableBody"></tbody>
                    </table>
                </div>

                <div class="glass-card" style="margin-top: 16px; padding: 16px; display: flex; justify-content: space-between; background: rgba(255,255,255,0.02);">
                    <span>总计: <strong id="previewTotal">0</strong></span>
                    <span>已选: <strong id="previewSelected">0</strong></span>
                    <span>有效: <strong id="previewValid" style="color: #34d399">0</strong></span>
                    <span>无效: <strong id="previewInvalid" style="color: #ef4444">0</strong></span>
                </div>

                <div style="text-align: right; margin-top: 24px;">
                    <button class="btn btn-success" id="submitImportBtn" disabled>确认导入所选账户</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 模态框：登录 -->
    <div id="loginModal" class="modal-overlay" style="z-index: 2000;">
        <div class="modal-card" style="max-width: 400px; padding: 40px 32px; background: rgba(15, 23, 42, 0.9);">
            <div style="text-align: center; margin-bottom: 32px;">
                <div style="font-size: 3rem; margin-bottom: 16px;">🔐</div>
                <h3 style="font-size: 1.8rem; font-weight: 700; background: linear-gradient(135deg, #a5b4fc 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">身份验证</h3>
                <p style="color: var(--text-muted); margin-top: 8px;">请证明主人身份，喵！🐾</p>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">用户名</label>
                    <input type="text" id="loginUsername" class="input-glass" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label class="form-label">密码</label>
                    <input type="password" id="loginPassword" class="input-glass" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center; margin-top: 24px;">
                    确认身份
                </button>
            </form>
        </div>
    </div>

    <!-- 吐司通知容器 -->
    <div class="toast-container"></div>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>
